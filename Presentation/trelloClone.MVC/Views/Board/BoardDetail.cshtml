@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Board Title";
}
<head>
    <link rel="stylesheet" href="~/css/BoardDetail.css" asp-append-version="true" />
</head>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="board">
                <div class="board-title">
                    <h2 id="boardH2"></h2>
                </div>
                <div class="board-lists" id="listelervecardlar">
                    @* kartlar ve listeler listeneliyor *@
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Anime Section End -->
@section Scripts {
    <script>
        $(document).ready(function () {
            // Listeleri ve kartları JSON ile al
            $.ajax({
                url: "/Board/GetBoardWithIncludes/" + @ViewBag.BoardId,
                type: "GET",
                success: function (data) {
                    $("#boardH2").text(data.boardName);

                    addListsAndCards(data.lists);


                    // Sıralama işlevini ekle
                    $(".list-cards").sortable({
                        connectWith: ".list-cards",
                        helper: "clone",
                        update: function (event, ui) {
        
                            var newPosition = ui.item.index();
                            var cardId = ui.item.attr("data-card-id");
                            var newListId = ui.item.parent().parent().attr("data-list-id");
  
                            
                            const cardData = {
                                cardId: cardId,
                                listId: newListId, 
                                position: newPosition,
                            };

                            $.ajax({
                                url: "/Card/updateCardPosition",
                                type: "POST",
                                contentType: "application/json; charset=utf-8", 
                                data: JSON.stringify(cardData), 
                                success: function (data) {
                                    // sayfadaki cardları yeniden çek
                                }
                            });
                      
                           
                        },
                    });
                },
            });
        });

        function addListsAndCards(lists) {
            for (var i = 0; i < lists.length; i++) {
                var list = lists[i];
                $(".board-lists").append(
                    '<div class="list" data-list-id="' + list.id + '">' +
                    '<div class="list-title">' +
                    list.title +
                    '</div>' +
                    '<ul class="list-cards">' +
                    // Kartları buraya ekleyeceksiniz
                    '</ul>' +
                    '</div>'
                );

                // Kartları ekle
                for (var j = 0; j < list.cards.length; j++) {
                    var card = list.cards[j];
                    $(".list-cards").last().append(
                        '<li class="card" data-card-id="' + card.id + '">' +
                        '<div class="card-title">' +
                        card.title +
                        '</div>' +
                        '<div class="card-description">' +
                        card.description +
                        '</div>' +
                        '</li>'
                    );
                }
            }
        }
    </script>

}